<h1>Manage Events</h1>

<%= form_with url: admin_events_path, method: :get, local: true do %>
  <%= text_field_tag :q, params[:q], placeholder: "Search events..." %>
  <%= submit_tag "Search" %>
<% end %>

<%= form_with url: bulk_delete_admin_events_path, method: :delete, local: true do %>
  <table>
    <thead>
      <tr>
        <th>Select</th>
        <th>Name</th>
        <th>Date</th>
        <th>Location</th>
        <th>Created By</th>
        <th>Registrations</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @events.each do |event| %>
        <tr>
          <td><%= check_box_tag "event_ids[]", event.id %></td>
          <td><%= event.name %></td>
          <td><%= event.date %></td>
          <td><%= event.location %></td>
          <td><%= event.user&.name || event.user.email_address %></td>
          <td><%= event.registrations.count %></td>
          <td><%= event.closed? ? "Closed" : "Open" %></td>
          <td>
            <%= link_to "Show", admin_event_path(event) %> |
            <%= link_to "Edit", edit_admin_event_path(event) %> |
            <%= button_to "Delete", admin_event_path(event),
                          method: :delete,
                          form: { style: "display:inline" },
                          data: { confirm: "Are you sure you want to delete this event?" } %> |
            <% if event.closed? %>
              <%= button_to "Reopen", reopen_admin_event_path(event),
                            method: :patch,
                            form: { style: "display:inline" },
                            data: { confirm: "Reopen this event?" } %>
            <% else %>
              <%= button_to "Close", close_admin_event_path(event),
                            method: :patch,
                            form: { style: "display:inline" },
                            data: { confirm: "Close this event?" } %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= submit_tag "Bulk Delete", data: { confirm: "Are you sure you want to delete selected events?" } %>

  <%= link_to "Back to Dashboard", admin_dashboard_path %>
<% end %>
